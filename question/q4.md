WhatapOperator ë¡œ ì„¤ì¹˜í•œ ê²½ìš° ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

https://docs.whatap.io/kubernetes/whatap-operator

ì‚¬ìš©ìëŠ” `WhatapAgent` CR(Custom Resource)ì„ í†µí•´ ì˜¤í”ˆë©”íŠ¸ë¦­ ëŒ€ìƒì„ ì„¤ì •í•©ë‹ˆë‹¤.

1. **PodMonitor**: Pod ë ˆì´ë¸” ì…€ë ‰í„°ë¥¼ ì´ìš©í•œ ë™ì  ë””ìŠ¤ì»¤ë²„ë¦¬ (Prometheus Operatorì˜ PodMonitorì™€ ìœ ì‚¬)
2. **ServiceMonitor**: Service ë ˆì´ë¸” ì…€ë ‰í„°ë¥¼ ì´ìš©í•œ ë™ì  ë””ìŠ¤ì»¤ë²„ë¦¬ (Prometheus Operatorì˜ ServiceMonitorì™€ ìœ ì‚¬)
3. **StaticEndpoints**: ê³ ì •ëœ IP ì£¼ì†Œì™€ í¬íŠ¸ë¥¼ ì§ì ‘ ì…ë ¥ (Prometheusì˜ static_configsì™€ ìœ ì‚¬)

```yaml
features:
  openAgent:
    enabled: true
    targets:
      # 1. PodMonitor: Pod ë ˆì´ë¸” ì…€ë ‰í„°ë¥¼ ì´ìš©í•œ ë™ì  ë””ìŠ¤ì»¤ë²„ë¦¬
      - targetName: my-app-pod-metrics
        type: PodMonitor
        namespaceSelector:
          matchNames:
            - "production"
        selector:
          matchLabels:
            app: my-app
        endpoints:
        - port: "web-metrics"  # Pod Specì— ì •ì˜ëœ Port ì´ë¦„ ë˜ëŠ” ì‹¤ì œ Port ë²ˆí˜¸
          path: "/metrics"     # ê¸°ë³¸ê°’ì€ /metrics, í•„ìš”ì‹œ ì¬ì •ì˜
          interval: "15s"      # ê¸°ë³¸ê°’ì€ ì „ì—­ ì„¤ì •, í•„ìš”ì‹œ ì¬ì •ì˜
          scheme: "http"
          timeout: "10s"
	        metricRelabelConfigs:  # ìŠ¤í¬ë˜í•‘ í›„ ë©”íŠ¸ë¦­ ì¬ë¼ë²¨ë§ ì„¤ì •
	          - source_labels: [__name__]
	            regex: "http_requests_total"
	            action: keep
	          - source_labels: [method]
	            target_label: http_method
	            replacement: "${1}"
	            action: replace

      # 2. ServiceMonitor: Service ë ˆì´ë¸” ì…€ë ‰í„°ë¥¼ ì´ìš©í•œ ë™ì  ë””ìŠ¤ì»¤ë²„ë¦¬
      - targetName: my-service-metrics
        type: ServiceMonitor
        namespaceSelector:
          matchNames:
            - "default"
        selector:
          matchLabels:
            service: my-backend-service
        endpoints:
        - port: "http-metrics"  # Service Specì— ì •ì˜ëœ Port ì´ë¦„ ë˜ëŠ” ì‹¤ì œ Target Port ë²ˆí˜¸
          path: "/actuator/prometheus"
          interval: "30s"
	        metricRelabelConfigs:
	          - source_labels: [__name__]
	            regex: "jvm_.*"
	            action: keep
	          - source_labels: [area]
	            target_label: memory_area
	            replacement: "${1}"
	            action: replace

      # 3. StaticEndpoints: ê³ ì •ëœ IP ì£¼ì†Œì™€ í¬íŠ¸ë¥¼ ì§ì ‘ ì…ë ¥
      - targetName: my-external-db-metrics
        type: StaticEndpoints
        # enabled: true  # íƒ€ê²Ÿ í™œì„±í™” ì—¬ë¶€ (ê¸°ë³¸ê°’: true, ìƒëµ ê°€ëŠ¥)
        endpoints:
          - address: "192.168.1.100:9100"
            scheme: "http"
            path: "/metrics"
            interval: "60s"
            metricRelabelConfigs:
              - source_labels: [__name__]
                regex: "node_(cpu|memory).*"
                action: keep
              - source_labels: [instance]
                target_label: server
                replacement: "${1}"
                action: replace

```

### **PodMetrics ë° ServiceMetrics ì„¤ì • ìš”ì†Œ**

- **targetName**: íƒ€ê²Ÿì˜ ì´ë¦„ (ë¡œê¹… ë° ì‹ë³„ìš©)
- **type**: íƒ€ê²Ÿ ìœ í˜• ("PodMetrics" ë˜ëŠ” "ServiceMetrics")
- **namespaceSelector**: ìŠ¤í¬ë˜í•‘í•  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
    - `matchNames`: ì´ë¦„ìœ¼ë¡œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
    - `matchLabels`: ë ˆì´ë¸”ë¡œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
    - `matchExpressions`: í‘œí˜„ì‹ìœ¼ë¡œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
- **selector**: ìŠ¤í¬ë˜í•‘í•  íŒŒë“œ ë˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
    - `matchLabels`: ë ˆì´ë¸”ë¡œ íŒŒë“œ ë˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
    - `matchExpressions`: í‘œí˜„ì‹ìœ¼ë¡œ íŒŒë“œ ë˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
- **relabelConfigs**: íƒ€ê²Ÿ ë°œê²¬(Discovery) ë‹¨ê³„ì—ì„œ ë©”íƒ€ë°ì´í„°(*meta ë¼ë²¨ ë“±)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¼ë²¨ì„ ì¶”ê°€í•˜ê±°ë‚˜, ë³€ê²½í•©ë‹ˆë‹¤.(í”„ë¡œë©”í…Œìš°ìŠ¤ì˜ relabel_configsì™€ ìœ ì‚¬)*
- **endpoints**: ìŠ¤í¬ë˜í•‘í•  ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - port: ìŠ¤í¬ë˜í•‘í•  í¬íŠ¸ ì´ë¦„ ë˜ëŠ” ë²ˆí˜¸
    - path: ë©”íŠ¸ë¦­ ê²½ë¡œ (ê¸°ë³¸ê°’ì€ globalPath, í•„ìš”ì‹œ ì¬ì •ì˜)
    - interval: ìŠ¤í¬ë˜í•‘ ê°„ê²© (ê¸°ë³¸ê°’ì€ globalInterval, í•„ìš”ì‹œ ì¬ì •ì˜)
    - scheme: ìŠ¤í¬ë˜í•‘ í”„ë¡œí† ì½œ (http ë˜ëŠ” https, ê¸°ë³¸ê°’ http)
    - timeout: ìŠ¤í¬ë˜í•‘ íƒ€ì„ì•„ì›ƒ
    - basicAuth: HTTP Basic Authentication ì„¤ì • (Secret ì°¸ì¡°)
    - tlsConfig: TLS ì„¤ì •
    - metricRelabelConfigs: ìŠ¤í¬ë˜í•‘ í›„ ë©”íŠ¸ë¦­ ì¬ë¼ë²¨ë§ ì„¤ì • (í”„ë¡œë©”í…Œìš°ìŠ¤ì˜ metric_relabel_configsì™€ ìœ ì‚¬)
    - addNodeLabel: ë…¸ë“œ ë¼ë²¨ ì¶”ê°€ ì—¬ë¶€

### **StaticEndpoints ì„¤ì • ìš”ì†Œ**

- **targetName**: íƒ€ê²Ÿì˜ ì´ë¦„ (ë¡œê¹… ë° ì‹ë³„ìš©)
- **type**: íƒ€ê²Ÿ ìœ í˜• ("StaticEndpoints")
- **endpoints**: ìŠ¤í¬ë˜í•‘í•  ì—”ë“œí¬ì¸íŠ¸ ì •ì˜
    - `address`: ìŠ¤í¬ë˜í•‘í•  ëŒ€ìƒ ì£¼ì†Œ (IP:PORT ë˜ëŠ” HOSTNAME:PORT)
    - `path`: ë©”íŠ¸ë¦­ ê²½ë¡œ (ê¸°ë³¸ê°’: /metrics)
    - `scheme`: ìŠ¤í¬ë˜í•‘ í”„ë¡œí† ì½œ (http ë˜ëŠ” https, ê¸°ë³¸ê°’ http)
    - `interval`: ìŠ¤í¬ë˜í•‘ ê°„ê²© (ê¸°ë³¸ê°’: 60s)
    - `basicAuth`: HTTP Basic Authentication ì„¤ì •
    - `tlsConfig`: TLS ì„¤ì •
    - `metricRelabelConfigs`: ìŠ¤í¬ë˜í•‘ í›„ ë©”íŠ¸ë¦­ ì¬ë¼ë²¨ë§ ì„¤ì •

### **addNodeLabel ê¸°ëŠ¥**

ìŠ¤í¬ë© ëŒ€ìƒì´ ë…¸ë“œì— ìŠ¤ì¼€ì¥´ë§ ë˜ì–´ ìˆëŠ” ê²½ìš° Â `addNodeLabel`Â ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ìŠ¤ì¼€ì¤„ë§ëœ ë…¸ë“œì˜ ì´ë¦„ì„ ë©”íŠ¸ë¦­ì— ë¼ë²¨ë¡œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **ì„¤ì • ìœ„ì¹˜**: ì—”ë“œí¬ì¸íŠ¸ ë ˆë²¨ì—ì„œ ì„¤ì • ê°€ëŠ¥
- **ê¸°ë³¸ê°’**:Â `false`
- **ë™ì‘**:Â `true`ë¡œ ì„¤ì •í•˜ë©´ ëª¨ë“  ë©”íŠ¸ë¦­ì—Â `node`Â ë¼ë²¨ì´ ì¶”ê°€ë˜ë©°, ì˜¤ë¸Œì íŠ¸ê°€ ì‹¤í–‰ ì¤‘ì¸ ë…¸ë“œì˜ ì´ë¦„ì´ ê°’ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤.
- **ì‚¬ìš©ì˜ˆì œ**

    ```yaml
    # íƒ€ê²Ÿ ë ˆë²¨ì—ì„œ addNodeLabel ì„¤ì •
    - targetName: node-exporter
      type: PodMonitor
      namespaceSelector:
        matchNames:
          - "monitoring"
      selector:
        matchLabels:
          app: node-exporter
      endpoints:
        - port: "metrics"
          path: "/metrics"
    	    interval: "30s"
    	    addNodeLabel: true  # ì´ ì—”ë“œí¬ì¸íŠ¸ì— ë…¸ë“œ ë¼ë²¨ ì¶”ê°€
    		  metricRelabelConfigs:
    		    # ë…¸ë“œ ë¼ë²¨ì„ ì‚¬ìš©í•œ ì¬ë¼ë²¨ë§ ì˜ˆì œ
    		    - source_labels: [node]
    		      target_label: kubernetes_node
    		      action: replace
    
    # ì—”ë“œí¬ì¸íŠ¸ ë ˆë²¨ì—ì„œ addNodeLabel ì„¤ì •
    - targetName: dcgm-exporter
      type: PodMonitor
      namespaceSelector:
        matchNames:
          - "kube-system"
      selector:
        matchLabels:
          app: dcgm-exporter
      endpoints:
      - port: "metrics"
        path: "/metrics"
        interval: "30s"
        addNodeLabel: true  # ì´ ì—”ë“œí¬ì¸íŠ¸ì—ë§Œ ë…¸ë“œ ë¼ë²¨ ì¶”ê°€
    		metricRelabelConfigs:
    	    - source_labels: [node]
    	      target_label: gpu_node
    	      action: replace
    ```


### Basic Auth ì„¤ì •

OpenAgentëŠ” ì¸ì¦ì´ í•„ìš”í•œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ìŠ¤í¬ë˜í•‘í•˜ê¸° ìœ„í•´ HTTP Basic Authenticationì„ ì§€ì›í•©ë‹ˆë‹¤. ì‚¬ìš©ì ì´ë¦„(username)ê³¼ ë¹„ë°€ë²ˆí˜¸(password)ëŠ” Kubernetes Secretì„ í†µí•´ ì•ˆì „í•˜ê²Œ ê´€ë¦¬ë©ë‹ˆë‹¤.

- ì„¤ì • ìœ„ì¹˜ : endpoints í•˜ìœ„ì˜ basicAuth í•­ëª©ì—ì„œ ì„¤ì •í•©ë‹ˆë‹¤.
- **username**: ì‚¬ìš©ì ì´ë¦„ì„ ë‹´ê³  ìˆëŠ” Secret ì •ë³´
    - name: Secretì˜ ì´ë¦„
    - key: Secret ë‚´ì˜ Key
    - namespace: Secretì´ ìœ„ì¹˜í•œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ (ìƒëµ ì‹œ ì—ì´ì „íŠ¸ì™€ ë™ì¼í•œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤)
- **password**: ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹´ê³  ìˆëŠ” Secret ì •ë³´
    - name: Secretì˜ ì´ë¦„
    - key: Secret ë‚´ì˜ Key
    - namespace: Secretì´ ìœ„ì¹˜í•œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤
- ì„¤ì • ì˜ˆì œ

    ```yaml
    endpoints:
      - port: "metrics"
        path: "/metrics"
        basicAuth:
          username:
            name: my-auth-secret
            key: username
          password:
            name: my-auth-secret
            key: password
            namespace: monitoring # Secretì´ ë‹¤ë¥¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ìˆëŠ” ê²½ìš° ëª…ì‹œ
    ```


## **TLS ì„¤ì •**

OpenAgentëŠ” HTTPS ì—”ë“œí¬ì¸íŠ¸ì— ì—°ê²°í•  ë•Œ TLS(Transport Layer Security)ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.Â ë‹¤ìŒì€ TLS ê´€ë ¨ ì„¤ì • ì˜µì…˜ì…ë‹ˆë‹¤:

### **HTTP vs HTTPS ê²°ì • ë°©ë²•**

OpenAgentëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê·œì¹™ì— ë”°ë¼ HTTP ë˜ëŠ” HTTPS í”„ë¡œí† ì½œì„ ì‚¬ìš©í• ì§€ ê²°ì •í•©ë‹ˆë‹¤:

1. **PodMonitor ë° ServiceMonitor íƒ€ê²Ÿ**:
    - í¬íŠ¸ ì´ë¦„ì´ "https"ì¸ ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ HTTPSë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    - ê·¸ ì™¸ì˜ ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ HTTPë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
2. **StaticEndpoints íƒ€ê²Ÿ**:
    - TLS ì„¤ì •ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ HTTPSë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    - ê·¸ ì™¸ì˜ ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ HTTPë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
3. **ëª¨ë“  íƒ€ê²Ÿ ìœ í˜•**:
    - ì—”ë“œí¬ì¸íŠ¸ë‚˜ íƒ€ê²Ÿì— ëª…ì‹œì ìœ¼ë¡œÂ `scheme`Â ì„¤ì •ì´ ìˆëŠ” ê²½ìš°, ì´ ì„¤ì •ì´ ê¸°ë³¸ê°’ì„ ì¬ì •ì˜í•©ë‹ˆë‹¤.

### **TLS ì„¤ì • ì˜µì…˜**

TLS ì„¤ì •ì€Â `tlsConfig`Â ì„¹ì…˜ì—ì„œ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```yaml
endpoints:
  - port: "https"
    path: "/metrics"
    scheme: "https"  # ëª…ì‹œì ìœ¼ë¡œ HTTPS ì‚¬ìš© ì§€ì •
    tlsConfig:
      insecureSkipVerify: true  # ì¸ì¦ì„œ ê²€ì¦ ê±´ë„ˆë›°ê¸°

```

### **insecureSkipVerify**

`insecureSkipVerify`Â ì˜µì…˜ì€ ì„œë²„ ì¸ì¦ì„œì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ê±´ë„ˆë›°ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.Â ì´ ì˜µì…˜ì€ ë‹¤ìŒê³¼ ê°™ì€ ê²½ìš°ì— ìœ ìš©í•©ë‹ˆë‹¤:

- ìì²´ ì„œëª…ëœ ì¸ì¦ì„œë¥¼ ì‚¬ìš©í•˜ëŠ” ì„œë²„ì— ì—°ê²°í•  ë•Œ
- ê°œë°œ ë˜ëŠ” í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ì¸ì¦ì„œ ê²€ì¦ì´ í•„ìš”í•˜ì§€ ì•Šì„ ë•Œ
- ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì„œë²„ì— ì—°ê²°í•  ë•Œ

**ì£¼ì˜**:Â í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ë³´ì•ˆìƒì˜ ì´ìœ ë¡œÂ `insecureSkipVerify: false`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.Â ìì²´ ì„œëª…ëœ ì¸ì¦ì„œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°,Â ì¸ì¦ì„œë¥¼ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¸ì¦ ê¸°ê´€(CA)ìœ¼ë¡œ ì¶”ê°€í•˜ëŠ” ê²ƒì´ ë” ì•ˆì „í•œ ë°©ë²•ì…ë‹ˆë‹¤.

### **ì„¤ì • ì˜ˆì œ**

### **1. ServiceMonitorì—ì„œ TLS ì„¤ì • ì˜ˆì œ**

```yaml
- targetName: kube-apiserver
  type: ServiceMonitor
  namespaceSelector:
    matchNames:
      - "default"
  selector:
    matchLabels:
      component: apiserver
      provider: kubernetes
  endpoints:
    - port: "https"  # í¬íŠ¸ ì´ë¦„ì´ "https"ì´ë¯€ë¡œ ê¸°ë³¸ì ìœ¼ë¡œ HTTPS ì‚¬ìš©
      path: "/metrics"
      interval: "30s"
      scheme: "https"  # ëª…ì‹œì ìœ¼ë¡œ HTTPS ì§€ì • (ì„ íƒì‚¬í•­)
      tlsConfig:
        insecureSkipVerify: true  # ì¸ì¦ì„œ ê²€ì¦ ê±´ë„ˆë›°ê¸°
		  metricRelabelConfigs:
		    - source_labels: [__name__]
		      regex: "apiserver_request_total"
		      action: keep
		    - source_labels: [verb]
		      target_label: http_verb
			    replacement: "${1}"
		      action: replace

```

## íƒ€ê²Ÿ ì¬ë¼ë²¨ë§ ì„¤ì • (relabelConfigs)

> ğŸ’¡ relabelConfigsëŠ” ìŠ¤í¬ë˜í•‘ì„ ìˆ˜í–‰í•˜ê¸° ì „, íƒ€ê²Ÿ(Target) ìì²´ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•„í„°ë§í•˜ê±°ë‚˜ ë¼ë²¨ì„ ì¡°ì‘í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. (Prometheusì˜ relabel_configsì™€ ìœ ì‚¬)
>

## ì‚¬ìš© ëª©ì 

1. **íƒ€ê²Ÿ í•„í„°ë§ (Target Filtering)**
    - íŠ¹ì • ë©”íƒ€ë°ì´í„° ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ì•ŠëŠ” íƒ€ê²Ÿì„ ìˆ˜ì§‘ ëŒ€ìƒì—ì„œ ì œì™¸í•©ë‹ˆë‹¤.
    - ì£¼ìš” Action: `keep`, `drop`
2. **ë©”íƒ€ ë¼ë²¨ ìŠ¹ê²© (Meta Label Promotion)**
    - `__meta_`ë¡œ ì‹œì‘í•˜ëŠ” ë©”íƒ€ë°ì´í„°ëŠ” ìŠ¤í¬ë˜í•‘ í›„ ì‚¬ë¼ì§‘ë‹ˆë‹¤.
    - ì´ë¥¼ ì˜êµ¬ì ì¸ ë¼ë²¨ë¡œ ì €ì¥í•˜ë ¤ë©´ ì´ ë‹¨ê³„ì—ì„œ `replace` actionì„ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ ì´ë¦„ìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.

## ì‚¬ìš© ê°€ëŠ¥í•œ Meta Labels

OpenAgentì—ì„œ ì œê³µí•˜ëŠ” ì£¼ìš” ë©”íƒ€ ë¼ë²¨ ëª©ë¡ì…ë‹ˆë‹¤.

### Common (ê³µí†µ)

- `__meta_kubernetes_namespace`: ì˜¤ë¸Œì íŠ¸ì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤
- `__address__`: íƒ€ê²Ÿ ì£¼ì†Œ (IP:Port)

### PodMonitor

- `__meta_kubernetes_pod_name`: Pod ì´ë¦„
- `__meta_kubernetes_pod_ip`: Pod IP
- `__meta_kubernetes_pod_ready`: Pod ì¤€ë¹„ ìƒíƒœ (`true`/`false`)
- `__meta_kubernetes_pod_phase`: Pod ìƒíƒœ (`Running`, `Pending` ë“±)
- `__meta_kubernetes_pod_node_name`: Podê°€ ì‹¤í–‰ ì¤‘ì¸ ë…¸ë“œ ì´ë¦„
- `__meta_kubernetes_pod_label_<labelname>`: Podì˜ ë¼ë²¨
- `__meta_kubernetes_pod_annotation_<annotationname>`: Podì˜ ì–´ë…¸í…Œì´ì…˜

### ServiceMonitor

- `__meta_kubernetes_service_name`: Service ì´ë¦„
- `__meta_kubernetes_service_cluster_ip`: Cluster IP
- `__meta_kubernetes_service_label_<labelname>`: Serviceì˜ ë¼ë²¨

```yaml
targets:
  - targetName: my-pod-monitor
    type: PodMonitor
    selector:
      matchLabels:
        app: my-app
    # íƒ€ê²Ÿ ë°œê²¬ ë‹¨ê³„ì—ì„œì˜ ë¼ë²¨ë§
    relabelConfigs:
      # 1. Pod ì´ë¦„ì„ pod_name ë¼ë²¨ë¡œ ì €ì¥ (ë©”íŠ¸ë¦­ì— pod_name ë¼ë²¨ì´ ë¶™ìŒ)
      - source_labels: ["__meta_kubernetes_pod_name"]
        target_label: "pod_name"
        action: "replace"
      
      # 2. íŠ¹ì • ë¼ë²¨(scrape_enabled=true)ì´ ì—†ëŠ” PodëŠ” ìˆ˜ì§‘ ì œì™¸
      - source_labels: ["__meta_kubernetes_pod_label_scrape_enabled"]
        regex: "true"
        action: "keep"
```

## **ë©”íŠ¸ë¦­ ì¬ë¼ë²¨ë§ ì„¤ì • (metricRelabelConfigs)**

OpenAgentëŠ” í”„ë¡œë©”í…Œìš°ìŠ¤ì˜ metric_relabel_configsì™€ ìœ ì‚¬í•œ ë©”íŠ¸ë¦­ ì¬ë¼ë²¨ë§ ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤.Â ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ ìŠ¤í¬ë˜í•‘ í›„ ë©”íŠ¸ë¦­ì„ í•„í„°ë§í•˜ê±°ë‚˜ ë ˆì´ë¸”ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **ì¬ë¼ë²¨ë§ ì„¤ì • ìš”ì†Œ**

- **source_labels**: ì†ŒìŠ¤ ë ˆì´ë¸” ëª©ë¡ (ë°°ì—´)
- **separator**: ì†ŒìŠ¤ ë ˆì´ë¸” ê°’ì„ ì—°ê²°í•  ë•Œ ì‚¬ìš©í•  êµ¬ë¶„ì (ê¸°ë³¸ê°’:Â `;`)
- **target_label**: ëŒ€ìƒ ë ˆì´ë¸” (ê²°ê³¼ë¥¼ ì €ì¥í•  ë ˆì´ë¸”)
- **regex**: ì†ŒìŠ¤ ë ˆì´ë¸” ê°’ì— ì ìš©í•  ì •ê·œì‹
- **replacement**: ëŒ€ì²´ ê°’ (ì •ê·œì‹ ìº¡ì²˜ ê·¸ë£¹ ì°¸ì¡° ê°€ëŠ¥, ì˜ˆ:Â `${1}`)
- **action**: ìˆ˜í–‰í•  ì‘ì—… (keep, drop, replace)

### **ì§€ì›ë˜ëŠ” ì‘ì—… (action)**

- **keep**: ì •ê·œì‹ê³¼ ì¼ì¹˜í•˜ëŠ” ë©”íŠ¸ë¦­ë§Œ ìœ ì§€
- **drop**: ì •ê·œì‹ê³¼ ì¼ì¹˜í•˜ëŠ” ë©”íŠ¸ë¦­ ì œê±°
- **replace**: ëŒ€ìƒ ë ˆì´ë¸”ì˜ ê°’ì„ ëŒ€ì²´ ê°’ìœ¼ë¡œ ë³€ê²½

### **íŠ¹ìˆ˜ ë ˆì´ë¸”**

- **name**: ë©”íŠ¸ë¦­ ì´ë¦„ì„ ë‚˜íƒ€ë‚´ëŠ” íŠ¹ìˆ˜ ë ˆì´ë¸”

### **ì˜ˆì œ**

### **1. íŠ¹ì • ë©”íŠ¸ë¦­ë§Œ ìœ ì§€**

```yaml
metricRelabelConfigs:
  - source_labels: [__name__]
    regex: "http_requests_total"
    action: keep

```

ì´ ì„¤ì •ì€Â `http_requests_total`Â ë©”íŠ¸ë¦­ë§Œ ìœ ì§€í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” ëª¨ë‘ ì œê±°í•©ë‹ˆë‹¤.

**ë™ì‘ ì˜ˆì‹œ:**

ì›ë˜ ìŠ¤í¬ë©ëœ ë©”íŠ¸ë¦­ì´ ë‹¤ìŒê³¼ ê°™ë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤:

```
http_requests_total{method="GET", status="200"} 100
http_errors_total{method="GET", status="500"} 5
node_cpu_seconds_total{cpu="0", mode="idle"} 1000

```

ìœ„ metricRelabelConfigsë¥¼ ì ìš©í•˜ë©´:

```
http_requests_total{method="GET", status="200"} 100

```

`http_requests_total`Â ë©”íŠ¸ë¦­ë§Œ ìœ ì§€ë˜ê³  ë‹¤ë¥¸ ë©”íŠ¸ë¦­ë“¤ì€ ëª¨ë‘ ì œê±°ë©ë‹ˆë‹¤.

### **2. ì •ê·œì‹ì„ ì‚¬ìš©í•œ ë©”íŠ¸ë¦­ í•„í„°ë§**

```yaml
metricRelabelConfigs:
  - source_labels: [__name__]
    regex: "node_(cpu|memory).*"
    action: keep

```

ì´ ì„¤ì •ì€Â `node_cpu`ë‚˜Â `node_memory`ë¡œ ì‹œì‘í•˜ëŠ” ë©”íŠ¸ë¦­ë§Œ ìœ ì§€í•©ë‹ˆë‹¤.

**ë™ì‘ ì˜ˆì‹œ:**

ì›ë˜ ìŠ¤í¬ë©ëœ ë©”íŠ¸ë¦­ì´ ë‹¤ìŒê³¼ ê°™ë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤:

```
node_cpu_seconds_total{cpu="0", mode="idle"} 1000
node_memory_MemTotal_bytes{} 16777216
node_disk_io_time_seconds_total{device="sda"} 100
http_requests_total{method="GET", status="200"} 100

```

ìœ„ metricRelabelConfigsë¥¼ ì ìš©í•˜ë©´:

```
node_cpu_seconds_total{cpu="0", mode="idle"} 1000
node_memory_MemTotal_bytes{} 16777216

```

`node_cpu`ë‚˜Â `node_memory`ë¡œ ì‹œì‘í•˜ëŠ” ë©”íŠ¸ë¦­ë§Œ ìœ ì§€ë˜ê³  ë‹¤ë¥¸ ë©”íŠ¸ë¦­ë“¤ì€ ëª¨ë‘ ì œê±°ë©ë‹ˆë‹¤.Â ì •ê·œì‹ì„ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ ë©”íŠ¸ë¦­ íŒ¨í„´ì„ í•œ ë²ˆì— í•„í„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **3. ë ˆì´ë¸” ì´ë¦„ ë³€ê²½**

```yaml
metricRelabelConfigs:
  - source_labels: [method]
    target_label: http_method
    replacement: "${1}"
    action: replace

```

ì´ ì„¤ì •ì€Â `method`Â ë ˆì´ë¸”ì˜ ê°’ì„Â `http_method`Â ë ˆì´ë¸”ë¡œ ë³µì‚¬í•©ë‹ˆë‹¤.

**ë™ì‘ ì˜ˆì‹œ:**

ì›ë˜ ìŠ¤í¬ë©ëœ ë©”íŠ¸ë¦­ì´ ë‹¤ìŒê³¼ ê°™ë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤:

```
http_requests_total{method="GET", path="/api", status="200"} 100
http_requests_total{method="POST", path="/api/users", status="201"} 50

```

ìœ„ metricRelabelConfigsë¥¼ ì ìš©í•˜ë©´:

```
http_requests_total{method="GET", path="/api", status="200", http_method="GET"} 100
http_requests_total{method="POST", path="/api/users", status="201", http_method="POST"} 50

```

ê° ë©”íŠ¸ë¦­ì—Â `method`Â ë ˆì´ë¸”ì˜ ê°’ì„ ë³µì‚¬í•œÂ `http_method`Â ë ˆì´ë¸”ì´ ì¶”ê°€ë©ë‹ˆë‹¤.Â ì›ë˜ ë ˆì´ë¸”ì€ ìœ ì§€ë˜ë©°,Â ìƒˆ ë ˆì´ë¸”ì´ ì¶”ê°€ë©ë‹ˆë‹¤.Â `${1}`ì€ ì†ŒìŠ¤ ë ˆì´ë¸”ì˜ ê°’ì„ ì°¸ì¡°í•©ë‹ˆë‹¤.

### **4. ì—¬ëŸ¬ ì†ŒìŠ¤ ë ˆì´ë¸” ì¡°í•©**

```yaml
metricRelabelConfigs:
  - source_labels: [__name__, status]
    regex: "http_requests_total;(200|500)"
    action: keep

```

ì´ ì„¤ì •ì€Â `http_requests_total`Â ë©”íŠ¸ë¦­ ì¤‘Â `status`Â ë ˆì´ë¸”ì´Â `200`Â ë˜ëŠ”Â `500`ì¸ ë©”íŠ¸ë¦­ë§Œ ìœ ì§€í•©ë‹ˆë‹¤.

**ë™ì‘ ì˜ˆì‹œ:**

ì›ë˜ ìŠ¤í¬ë©ëœ ë©”íŠ¸ë¦­ì´ ë‹¤ìŒê³¼ ê°™ë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤:

```
http_requests_total{method="GET", path="/api", status="200"} 100
http_requests_total{method="POST", path="/api/users", status="201"} 50
http_requests_total{method="GET", path="/api/error", status="500"} 10
http_requests_total{method="GET", path="/api/error", status="404"} 5

```

ìœ„ metricRelabelConfigsë¥¼ ì ìš©í•˜ë©´:

```
http_requests_total{method="GET", path="/api", status="200"} 100
http_requests_total{method="GET", path="/api/error", status="500"} 10

```

`http_requests_total`Â ë©”íŠ¸ë¦­ ì¤‘ì—ì„œÂ `status`Â ë ˆì´ë¸”ì´Â `200`Â ë˜ëŠ”Â `500`ì¸ ë©”íŠ¸ë¦­ë§Œ ìœ ì§€ë©ë‹ˆë‹¤.Â ì—¬ëŸ¬ ì†ŒìŠ¤ ë ˆì´ë¸”ì„ ì¡°í•©í•  ë•ŒëŠ” ê¸°ë³¸ì ìœ¼ë¡œÂ `;`Â êµ¬ë¶„ìë¡œ ì—°ê²°ë˜ë©°,Â ì´ë¥¼Â `separator`Â í•„ë“œë¡œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **5. ì •ì  ë ˆì´ë¸” ì¶”ê°€**

```yaml
metricRelabelConfigs:
  - target_label: metric_src
    replacement: "whatap-open-agent"
    action: replace

```

ì´ ì„¤ì •ì€ ëª¨ë“  ë©”íŠ¸ë¦­ì—Â `metric_src="whatap-open-agent"`Â ë ˆì´ë¸”ì„ ì¶”ê°€í•©ë‹ˆë‹¤.Â ì†ŒìŠ¤ ë ˆì´ë¸”ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´Â `replacement`Â ê°’ì´ ì§ì ‘ ë ˆì´ë¸” ê°’ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.Â ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  ë©”íŠ¸ë¦­ì— í™˜ê²½,Â ë¦¬ì „,Â ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„ ë“±ì˜ ì •ì  ë ˆì´ë¸”ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë™ì‘ ì˜ˆì‹œ:**

ì›ë˜ ìŠ¤í¬ë©ëœ ë©”íŠ¸ë¦­ì´ ë‹¤ìŒê³¼ ê°™ë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤:

```
http_requests_total{method="GET", path="/api", status="200"} 100
node_cpu_seconds_total{cpu="0", mode="idle"} 1000

```

ìœ„ metricRelabelConfigsë¥¼ ì ìš©í•˜ë©´:

```
http_requests_total{method="GET", path="/api", status="200", metric_src="whatap-open-agent"} 100
node_cpu_seconds_total{cpu="0", mode="idle", metric_src="whatap-open-agent"} 1000

```

ëª¨ë“  ë©”íŠ¸ë¦­ì—Â `metric_src="whatap-open-agent"`Â ë ˆì´ë¸”ì´ ì¶”ê°€ë©ë‹ˆë‹¤.Â ì´ ë°©ë²•ì€ ë©”íŠ¸ë¦­ì˜ ì¶œì²˜ë¥¼ í‘œì‹œí•˜ê±°ë‚˜,Â í™˜ê²½(ì˜ˆ:Â production,Â staging),Â ë¦¬ì „(ì˜ˆ:Â us-east,Â eu-west),Â ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„ ë“±ì„ í‘œì‹œí•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤.

### **ì¢…í•©ì ì¸ ë™ì‘ ì˜ˆì‹œ**

ì›ë˜ ìŠ¤í¬ë©ëœ ë©”íŠ¸ë¦­ì´ ë‹¤ìŒê³¼ ê°™ë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤:

```
apiserver_request_total{code="200", resource="pods", verb="GET"} 100
some_other_metric{label="value"} 50

```

ìœ„ metricRelabelConfigsë¥¼ ì ìš©í•˜ë©´:

1. ì²« ë²ˆì§¸ ë£°(keep apiserver_request_total) ì ìš©:
    - apiserver_request_total ë©”íŠ¸ë¦­ì€ ìœ ì§€ë©ë‹ˆë‹¤.
    - some_other_metric ë©”íŠ¸ë¦­ì€ ë“œë¡­ë©ë‹ˆë‹¤.
2. ë‘ ë²ˆì§¸ ë£°(replace verb -> http_verb) ì ìš©:
    - ìœ ì§€ëœ apiserver_request_total ë©”íŠ¸ë¦­ì— verb ë ˆì´ë¸”ì´ ìˆìœ¼ë¯€ë¡œ, ì´ ë ˆì´ë¸”ì˜ ê°’(GET)ì´ http_verbë¼ëŠ” ìƒˆë¡œìš´ ë ˆì´ë¸”ë¡œ ë³µì‚¬ë©ë‹ˆë‹¤.

ë”°ë¼ì„œ ìµœì¢…ì ìœ¼ë¡œ ìˆ˜ì§‘ë˜ëŠ” ë©”íŠ¸ë¦­ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```
apiserver_request_total{code="200", resource="pods", verb="GET", http_verb="GET"} 100

```

## **ì¿ ë²„ë„¤í‹°ìŠ¤ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì˜ˆì œ**

ë‹¤ìŒì€ ì¿ ë²„ë„¤í‹°ìŠ¤ API ì„œë²„ì—ì„œ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ëŠ” ì˜ˆì œì…ë‹ˆë‹¤:

```yaml
# scrape_config.yaml
features:
  openAgent:
    enabled: true
    ~~globalInterval: "60s"
    globalPath: "/metrics"~~
    targets:
      - targetName: kube-apiserver
        type: ServiceMonitor
        namespaceSelector:
          matchNames:
            - "kube-system"
        selector:
          matchLabels:
            component: apiserver
            provider: kubernetes
        endpoints:
          - port: "https"
            path: "/metrics"
	          interval: "30s"
		        metricRelabelConfigs:
		          - source_labels: [__name__]
		            regex: "apiserver_request_total"
		            action: keep
		          - source_labels: [verb]
		            target_label: http_verb
		            replacement: "${1}"
		            action: replace
		          # ì •ì  ë ˆì´ë¸” ì¶”ê°€
		          - target_label: metric_src
		            replacement: "whatap-open-agent"
		            action: replace
```

ì´ ì„¤ì •ì€ kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ component=apiserver ë° provider=kubernetes ë ˆì´ë¸”ì„ ê°€ì§„ ì„œë¹„ìŠ¤ë¥¼ ì°¾ì•„ í•´ë‹¹ ì„œë¹„ìŠ¤ì˜ ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•©ë‹ˆë‹¤.

metricRelabelConfigsë¥¼ ì‚¬ìš©í•˜ì—¬ apiserver_request_total ë©”íŠ¸ë¦­ë§Œ ìˆ˜ì§‘í•˜ê³ ,Â verb ë ˆì´ë¸”ì„ http_verb ë ˆì´ë¸”ë¡œ ë³€í™˜í•˜ë©°,Â ëª¨ë“  ë©”íŠ¸ë¦­ì— metric_src="whatap-open-agent"Â ì •ì  ë ˆì´ë¸”ì„ ì¶”ê°€í•˜ë„ë¡ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë³„ë„ì˜ CRì„ ì´ìš©í•œ ì„¤ì • (WhatapPodMonitor, WhatapServiceMonitor)

`WhatapAgent` ë‚´ë¶€ì˜ `features.openAgent.targets` í•­ëª©ì— ì„¤ì •ì„ ì¶”ê°€í•˜ëŠ” ë°©ì‹ ì™¸ì—ë„, `WhatapPodMonitor`ì™€ `WhatapServiceMonitor`ë¼ëŠ” ë³„ë„ì˜ Custom Resource(CR)ë¥¼ ìƒì„±í•˜ì—¬ ëª¨ë‹ˆí„°ë§ ëŒ€ìƒì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ ë°©ì‹ì€ ëª¨ë‹ˆí„°ë§ ëŒ€ìƒì„ ê°œë³„ íŒŒì¼ë¡œ ê´€ë¦¬í•˜ê±°ë‚˜, ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ì™€ í•¨ê»˜ ëª¨ë‹ˆí„°ë§ ì„¤ì •ì„ ë°°í¬í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.

### WhatapPodMonitor ì˜ˆì œ

**Pod**ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ëª¨ë‹ˆí„°ë§ ì„¤ì •ì„ ì •ì˜í•©ë‹ˆë‹¤.  podMonitor ì™€ ìœ ì‚¬í•œ ì—­í• ì„ í•©ë‹ˆë‹¤.

ì•„ë˜ëŠ” nvidia ì˜ dcgm-exporter ë¥¼ ìˆ˜ì§‘ ëŒ€ìƒì— ì¶”ê°€í•˜ëŠ” ì˜ˆì œì…ë‹ˆë‹¤.

```yaml
apiVersion: monitoring.whatap.com/v2alpha1
kind: WhatapPodMonitor
metadata:
  name: dcgm-exporter-monitor
  namespace: default
spec:
  # jobLabel: í•´ë‹¹ ë¼ë²¨ì˜ ê°’ì„ Job ì´ë¦„ìœ¼ë¡œ ì‚¬ìš© (ì„ íƒ ì‚¬í•­)
  jobLabel: app
  
  # namespaceSelector: ëª¨ë‹ˆí„°ë§í•  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì„ íƒ
  # (ìƒëµ ì‹œ CRì´ ìƒì„±ëœ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•¨)
  namespaceSelector:
    matchNames:
      - monitoring #ëŒ€ìƒ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¡œ ë³€ê²½í•˜ì—¬ ì…ë ¥
    # matchLabels:
    #   environment: production

  # selector: ëŒ€ìƒ Pod ì„ íƒ (Label Selector)
  selector:
    matchLabels: #ëŒ€ìƒ íŒŒë“œì˜ ë¼ë²¨ë¡œ ë³€ê²½í•˜ì—¬ ì…ë ¥
      app: dcgm-exporter
      
  # endpoints: ìŠ¤í¬ë˜í•‘í•  ì—”ë“œí¬ì¸íŠ¸ ì •ì˜
  endpoints:
    - port: "9400"       # Podì˜ Port ì´ë¦„ ë˜ëŠ” ë²ˆí˜¸
      path: /metrics
      scheme: http
      interval: 30s
      addNodeLabel: true # ëŒ€ìƒ íŒŒë“œì˜ ë…¸ë“œ ì •ë³´ë¥¼ ì¶”ê°€
      metricRelabelConfigs:
      - target_label: wtp_src
        replacement: "true"
        action: replace
      - source_labels: [__name__]
        regex: "DCGM.*"
        action: keep

  # relabelConfigs: íƒ€ê²Ÿ ë°œê²¬ ë‹¨ê³„ì—ì„œì˜ ë¼ë²¨ë§ (ì„ íƒ ì‚¬í•­)
  #
  # [ì‚¬ìš© ê°€ëŠ¥í•œ Meta Labels]
  # - __meta_kubernetes_namespace: ì˜¤ë¸Œì íŠ¸ì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤
  # - __meta_kubernetes_pod_name: Pod ì´ë¦„
  # - __meta_kubernetes_pod_ip: Pod IP
  # - __meta_kubernetes_pod_ready: Pod ì¤€ë¹„ ìƒíƒœ (true/false)
  # - __meta_kubernetes_pod_phase: Pod ìƒíƒœ (Running, Pending ë“±)
  # - __meta_kubernetes_pod_node_name: Podê°€ ì‹¤í–‰ ì¤‘ì¸ ë…¸ë“œ ì´ë¦„
  # - __meta_kubernetes_pod_label_<labelname>: Podì˜ ë¼ë²¨
  # - __meta_kubernetes_pod_annotation_<annotationname>: Podì˜ ì–´ë…¸í…Œì´ì…˜
  relabelConfigs:
    - source_labels: [__meta_kubernetes_pod_name]
      target_label: pod_name
      action: replace
```

### WhatapServiceMonitor ì˜ˆì œ

`WhatapServiceMonitor`ëŠ” Serviceë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ëª¨ë‹ˆí„°ë§ ì„¤ì •ì„ ì •ì˜í•©ë‹ˆë‹¤.

```yaml
apiVersion: monitoring.whatap.com/v2alpha1
kind: WhatapServiceMonitor
metadata:
  name: example-service-monitor
  namespace: default
spec:
  # jobLabel: í•´ë‹¹ ë¼ë²¨ì˜ ê°’ì„ Job ì´ë¦„ìœ¼ë¡œ ì‚¬ìš© (ì„ íƒ ì‚¬í•­)
  jobLabel: k8s-app
  
  # namespaceSelector: ëª¨ë‹ˆí„°ë§í•  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì„ íƒ
  namespaceSelector:
    matchNames:
      - default

  # selector: ëŒ€ìƒ Service ì„ íƒ (Label Selector)
  selector:
    matchLabels:
      app: my-service
      
  # endpoints: ìŠ¤í¬ë˜í•‘í•  ì—”ë“œí¬ì¸íŠ¸ ì •ì˜
  endpoints:
    - port: web       # Serviceì˜ Port ì´ë¦„ ë˜ëŠ” ë²ˆí˜¸
      path: /metrics
      scheme: http
      interval: 30s
      
  # relabelConfigs: íƒ€ê²Ÿ ë°œê²¬ ë‹¨ê³„ì—ì„œì˜ ë¼ë²¨ë§ (ì„ íƒ ì‚¬í•­)
  #
  # [ì‚¬ìš© ê°€ëŠ¥í•œ Meta Labels]
  # - __meta_kubernetes_namespace: ì˜¤ë¸Œì íŠ¸ì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤
  # - __meta_kubernetes_service_name: Service ì´ë¦„
  # - __meta_kubernetes_service_cluster_ip: Cluster IP
  # - __meta_kubernetes_service_label_<labelname>: Serviceì˜ ë¼ë²¨
  # - __meta_kubernetes_pod_name: Pod ì´ë¦„ (Endpointê°€ Podì¸ ê²½ìš°)
  # - __meta_kubernetes_pod_node_name: Podê°€ ì‹¤í–‰ ì¤‘ì¸ ë…¸ë“œ ì´ë¦„ (Endpointê°€ Podì¸ ê²½ìš°)
  relabelConfigs:
    - source_labels: [__meta_kubernetes_pod_name]
      target_label: pod_name
      action: replace
```

### ì£¼ìš” ì„¤ì • í•„ë“œ

- **selector**: ëª¨ë‹ˆí„°ë§ ëŒ€ìƒ Pod ë˜ëŠ” Serviceë¥¼ ì„ íƒí•˜ëŠ” ë ˆì´ë¸” ì…€ë ‰í„°ì…ë‹ˆë‹¤. `matchLabels` ë˜ëŠ” `matchExpressions`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **namespaceSelector**: ëŒ€ìƒì´ ìœ„ì¹˜í•œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. ìƒëµ ì‹œ CRì´ ìƒì„±ëœ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **endpoints**: ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•  ì—”ë“œí¬ì¸íŠ¸ ì •ë³´ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ì •ì˜í•©ë‹ˆë‹¤. (`port`, `path`, `interval`, `scheme` ë“±)
- **jobLabel**: ìˆ˜ì§‘ëœ ë©”íŠ¸ë¦­ì˜ `job` ë¼ë²¨ ê°’ìœ¼ë¡œ ì‚¬ìš©í•  ëŒ€ìƒì˜ ë ˆì´ë¸” ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤. ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ CRì˜ ì´ë¦„ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.
- **relabelConfigs**: íƒ€ê²Ÿ ë””ìŠ¤ì»¤ë²„ë¦¬ ë‹¨ê³„ì—ì„œ ë©”íƒ€ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¼ë²¨ì„ ë³€ê²½í•˜ê±°ë‚˜ í•„í„°ë§í•˜ëŠ” ì„¤ì •ì„ ì •ì˜í•©ë‹ˆë‹¤.